# Addons: https://kops.sigs.k8s.io/addons/
  awsLoadBalancerController:
    enabled: true
  certManager:
    enabled: true
  nodeTerminationHandler:
    enabled: true
    #enableRebalanceMonitoring: true
    enableSQSTerminationDraining: true
    managedASGTag: "aws-node-termination-handler/managed"
  nodeProblemDetector:
    enabled: true
    memoryRequest: 32Mi
    cpuRequest: 10m
  podIdentityWebhook:
    enabled: true


#removing taints from master nodes
kubectl taint nodes --all=true node-role.kubernetes.io/control-plane:NoSchedule-
kubectl taint nodes --all=true node.kubernetes.io/unschedulable:NoSchedule-


#installed inginx-ingress controller
helm upgrade --install ingress-nginx ingress-nginx \
  --repo https://kubernetes.github.io/ingress-nginx \
  --namespace ingress-nginx --create-namespace

# replace default cni from kubenet to amazonvpc
  networking:
    amazonvpc:
      env:
      - name: WARM_IP_TARGET
        value: "10"
      - name: AWS_VPC_K8S_CNI_LOGLEVEL
        value: debug

#use spot instances by specifying max_price
maxPrice: "0.02"

# kill/drain worker node (set its max and min number to 0)

# increase maximum number of pods that can be scheduled on a node
kubelet:
  maxPods: 50


# add label to node in order to be selected or added in targetgroup binding
 kubectl label nodes --all addToTargetGroup=yes

#errors
error populating cluster spec: spec.cloudProvider.aws.nodeTerminationHandler.enableRebalanceMonitoring: Forbidden: rebalance even ts can only drain in Queue Processor mode


#ssh key to access nodes
kops create sshpublickey --name <clustername> -i ~/.ssh/newkey.pub
kops update cluster <clustername> 
kops rolling-update cluster --name <clustername> 